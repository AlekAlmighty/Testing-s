<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700&display=swap" rel="stylesheet">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Breathe Green - Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
  <link rel="stylesheet" href="stories.css">
  <script>
(function(){if(!window.chatbase||window.chatbase("getState")!=="initialized"){window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}window.chatbase.q.push(arguments)};window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}})}const onLoad=function(){const script=document.createElement("script");script.src="https://www.chatbase.co/embed.min.js";script.id="8yV-Evh-E6xXhzDfX5Z-A";script.domain="www.chatbase.co";document.body.appendChild(script)};if(document.readyState==="complete"){onLoad()}else{window.addEventListener("load",onLoad)}})();
</script>
</head>
<body>
 <header class="dashboard-header">
    <div class="header-container">
      <div class="logo">Breathe Green</div>
      <nav class="nav-links">
        <a href="#" class="active" data-target="home">Home</a>
        <a href="#" data-target="help">Help</a>
        <a href="#" data-target="money">Money Saved</a>
        <a href="#" data-target="milestones">Milestones</a>
        <a href="#" data-target="environment">Environment</a>
        <a href="badges.html" data-target="badges">Badges</a>
        <a href="stories.html" id="stories-link" data-target="stories">Stories</a>
        <button id="logout-btn" class="logout-btn">Logout</button>
      </nav>
    </div>
  </header>

  <main>
    <section id="home" class="content-section active">
      <div class="motivation-card">
        <p id="daily-motivation">STAY STRONG, YOU'RE DOING AMAZING!</p>
      </div>
      <div class="overview-grid">
        <div class="card highlight" id="money-saved-container">
          <h3>MONEY SAVED</h3>
          <p id="money-saved">‚Ç±0</p>
        </div>
        <div class="card highlight" id="streak-container">
          <h3>DAYS STREAK</h3>
          <p id="streak-days">0 Days</p>
        </div>
        <div class="card highlight" id="cigs-container">
          <h3>CIGARETTES NOT SMOKED</h3>
          <p id="cigarettes-avoided">0</p>
        </div>
        <div class="card highlight" id="environmental-impact-container">
          <h3>ENVIRONMENTAL IMPACT</h3>
          <p id="env-impact">0 lbs. helped</p>
        </div>
      </div>
    </section>

    <section id="help" class="content-section">
      <!-- DEBUG: Days Editor Section -->
      <div class="debug-section">
        <div class="debug-card">
          <h2>üîß Debug: Edit Days Quit</h2>
          <p>Test and verify calculations:</p>
          <div class="debug-input-group">
            <label for="debug-days-input">Days Quit:</label>
            <input type="number" id="debug-days-input" min="0" step="1" placeholder="Enter days" />
            <button id="debug-apply-btn" class="debug-btn">Apply</button>
          </div>

          <div class="debug-samples">
            <p>Quick Test Samples:</p>
            <div class="debug-sample-buttons">
              <button class="debug-sample-btn" data-days="1">1 Day</button>
              <button class="debug-sample-btn" data-days="7">1 Week</button>
              <button class="debug-sample-btn" data-days="30">1 Month</button>
              <button class="debug-sample-btn" data-days="90">3 Months</button>
              <button class="debug-sample-btn" data-days="180">6 Months</button>
              <button class="debug-sample-btn" data-days="365">1 Year</button>
            </div>
          </div>
          
          <div class="debug-results">
            <div class="debug-result-item">
              <span class="debug-label">Money Saved (‚Ç±):</span>
              <span class="debug-value" id="debug-money">‚Ç±0</span>
            </div>
            <div class="debug-result-item">
              <span class="debug-label">Cigarettes Avoided:</span>
              <span class="debug-value" id="debug-cigs">0</span>
            </div>
            <div class="debug-result-item">
              <span class="debug-label">Day Streak:</span>
              <span class="debug-value" id="debug-streak">0 Days</span>
            </div>
            <div class="debug-result-item">
              <span class="debug-label">CO‚ÇÇ Prevented (kg):</span>
              <span class="debug-value" id="debug-co2">0 kg</span>
            </div>
          </div>

          <div class="debug-info">
            <p><strong>Profile Data Used:</strong></p>
            <ul id="debug-profile-info"></ul>
          </div>
        </div>
      </div>

      <div class="help-grid">
        <div class="card help-card" id="breathing-card">
          <h3>4-2-4 BREATHING TECHNIQUE</h3>
          <p>The 4-2-4 breathing technique involves inhaling for 4 seconds, holding for 2, and exhaling for 4.</p>
          <br>
          <p>It activates the parasympathetic nervous system, reducing stress and promoting relaxation.</p>
          <br>
          <p>Research shows it lowers heart rate, blood pressure, and stress hormones, while improving focus and emotional control.</p>
          <br>
          <p>Overall, it is a simple, evidence-based method to enhance mental and physical well-being.</p>
          <br>
          <button class="help-btn" id="start-breathing">Start</button>
          <button id="exit-breathing">Exit</button>
        </div>

        <div class="card help-card" id="games-card">
          <h3>QUICK GAMES</h3>
          <p>Play short mini-games to distract yourself from cravings.</p>
          <button class="help-btn" id="play-mini-games">Play Mini Games</button>
        </div>
        <div class="card help-card" id="reasons-card">
          <h3>REASONS TO QUIT</h3>
          <p>Write and revisit your personal reasons for quitting.</p>
          <button class="help-btn" id="open-notepad">Open Notepad</button>
        </div>

        <div id="notepad-overlay" aria-hidden="true">
          <div class="notepad-window">
            <div class="notepad-header">
              <h4>My Reasons to Quit</h4>
              <button id="close-notepad" class="notepad-close">√ó</button>
            </div>

            <div class="notepad-body">
              <textarea
                id="reason-text"
                placeholder="Write your reason here..."
              ></textarea>
              <button id="add-reason" class="notepad-add">Save Reason</button>
              <ul id="reasons-list">
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="money" class="content-section">
      <div class="money-header">
        <h1>‚Ç±0 Saved</h1>
        <p>Since you quit on January 5, 2025</p>
      </div>

      <div class="savings-grid">
        <div class="savings-card">
          <h4>Daily Savings</h4>
          <p>‚Ç±0</p>
        </div>
        <div class="savings-card">
          <h4>Weekly Savings</h4>
          <p>‚Ç±0</p>
        </div>
        <div class="savings-card">
          <h4>Monthly Savings</h4>
          <p>‚Ç±0</p>
        </div>
      </div>

      <div class="goal-section">
        <h3>Next Goal: ‚Ç±<span id="editable-goal" contenteditable="true">7000</span></h3>
        <div class="goal-bar">
          <div class="goal-progress" style="width: 46%;"></div>
        </div>
        <p class="goal-progress-text">‚Ç±3,240 of ‚Ç±7,000 reached</p>
      </div>

      <div class="chart-section">
        <canvas id="savingsChart"></canvas>
      </div>

      <div class="buy-section">
        <h3>What You Could Buy üí∏</h3>
        <ul>
          <li>üëü A new pair of running shoes</li>
          <li>üçΩÔ∏è 3 nice dinners out</li>
          <li>üí™ 2 months of gym membership</li>
        </ul>
      </div>
    </section>

    <section id="milestones" class="content-section">
      <div class="milestones-container">
        
        <div class="milestone-header">
          <h1 id="milestone-days">Smoke-Free Progress</h1>
          <p id="milestone-summary">Tracking your journey...</p>
        </div>

        <div class="milestone-card">
          <h3>üéØ Journey Timeline</h3>
          <ul id="milestone-timeline" class="milestone-timeline"></ul>
        </div>

        <div class="milestone-card">
          <h3>üí∞ Financial Milestones</h3>
          <ul id="milestone-financial" class="milestone-financial"></ul>
        </div>

        <div class="milestone-card">
          <h3>üí™ Health Milestones</h3>
          <table class="milestone-health">
            <thead>
              <tr><th>Time Smoke-Free</th><th>Health Benefit</th></tr>
            </thead>
            <tbody id="milestone-health-body"></tbody>
          </table>
        </div>

      </div>
    </section>

    <section id="environment" class="content-section">
      <div class="environment-header">
        <h1>Your Environmental Impact</h1>
        <p>Every cigarette you skip helps heal the planet üåé</p>
      </div>

      <div class="environment-grid">
        <div class="environment-card">
          <h3>üåø CO‚ÇÇ Prevented</h3>
          <p id="co2-prevented">0 kg</p>
        </div>
        <div class="environment-card">
          <h3>üå≤ Trees Saved</h3>
          <p id="trees-saved">0</p>
        </div>
        <div class="environment-card">
          <h3>üíß Toxins Avoided</h3>
          <p id="toxins-avoided">0</p>
        </div>
      </div>

            <div class="green-goal">
        <h3>Next Eco Goal</h3>
        <div class="goal-input-wrap">
          <label for="ecoGoal">Set your target (kg of CO‚ÇÇ)</label>
          <input type="number" id="ecoGoal" value="100" min="10" step="10" inputmode="numeric" autocomplete="off">
        </div>
        <div class="goal-bar">
          <div class="goal-progress" id="ecoGoalProgress" style="width: 0%;"></div>
        </div>
        <p id="ecoGoalText">0 of 100 kg prevented</p>
      </div>

      <div class="environment-chart-container">
        <h3>Air Saved Over Time</h3>
        <canvas id="environmentChart"></canvas>
      </div>
    </section>

    <!-- Badges moved to standalone badges.html -->

    <section id="stories" class="content-section" style="display:none;">
      <main class="stories-main">
        <section class="create-post">
          <h2>Share your story</h2>
          <form id="post-form">
            <div class="form-grid">
              <div class="file-input">
                <label for="image-input">Choose image (optional)</label>
                <input type="file" id="image-input" accept="image/*">
              </div>
              <div class="desc-input-wrap">
                <label for="desc-input">Description</label>
                <textarea id="desc-input" rows="4" placeholder="Write about your journey..."></textarea>
              </div>
              <div class="submit-wrap">
                <div class="spacer"></div>
                <button type="submit" id="post-btn">Post Story</button>
              </div>
            </div>
          </form>
        </section>
        <section class="posts-feed">
          <h2>Community Stories</h2>
          <div id="posts-container"></div>
        </section>
      </main>
    </section>

    <form id="loginForm" style="display:none;" onsubmit="return false;" novalidate></form>
  </main>

  <div id="game-overlay" aria-hidden="true">
    <div class="game-center">
      <div class="game-header">
        <div class="game-title">Mini Game Center</div>
        <button id="game-close" class="game-close" aria-label="Close">√ó</button>
      </div>
      <div class="game-body">
        <div class="game-menu" id="game-menu">
          <h3>Choose a game</h3>
          <div class="game-buttons">
            <button class="game-select" data-game="reflex">Reflex Challenge</button>
            <button class="game-select" data-game="clickspeed">Click Speed Test</button>
            <button class="game-select" data-game="memory">Memory Flip</button>
          </div>
        </div>
        <div class="game-area" id="game-area" hidden></div>
      </div>
    </div>
  </div>

<div id="pdf-options" style="position: fixed; bottom: 80px; left: 140px; font-family: 'Times New Roman', serif; display: flex; align-items: center; gap: 10px; background: #f8f8f8; padding: 8px 12px; border: 1px solid #ccc; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
  <input type="checkbox" id="includeTables" checked style="width:18px; height:18px; cursor:pointer;">
  <label for="includeTables" style="margin:0; font-size:14px; cursor:pointer;">Include tables in PDF</label>
</div>

  <button id="print-pdf-btn" title="Download PDF">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M5 20h14v-2H5v2zm7-18L5.33 9h3.34v4h6.66V9h3.34L12 2z"/>
    </svg>
  </button>

  <button id="progress-toggle" class="progress-toggle" aria-expanded="false" aria-controls="progress-panel">Progress</button>

  <aside id="progress-panel" class="progress-panel" aria-hidden="true" role="region" aria-label="Progress panel">
    <div class="progress-header">
      <h4>Your Progress</h4>
      <button id="progress-close" class="progress-close" aria-label="Close progress panel">√ó</button>
    </div>
    <div class="progress-body">
      <div class="progress-item"><span>Days Streak:</span><strong id="panel-streak">0 Days</strong></div>
      <div class="progress-item"><span>Money Saved:</span><strong id="panel-money">‚Ç±0</strong></div>
      <div class="progress-item"><span>Cigarettes Avoided:</span><strong id="panel-cigs">0</strong></div>
      <div class="progress-bar-outer"><div id="panel-goal-bar" class="progress-bar-inner" style="width:0%"></div></div>
      <div class="progress-item"><small id="panel-goal-text">‚Ç±0 of ‚Ç±7,000</small></div>
    </div>
  </aside>

  <script type="module" src="dashboard.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="stories.js"></script>

<div id="logout-screen">
  <div class="breathe-logo">
    <span>Breathe</span>
    <strong>Green</strong>
  </div>

  <div class="bubbles">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
  </div>

  <p class="loading-text">Logging you out...</p>
</div>

</div>

<script>
const logoutBtn = document.getElementById('logout-btn');
const logoutScreen = document.getElementById('logout-screen');

logoutBtn.addEventListener('click', () => {
  logoutScreen.style.display = 'flex';
  setTimeout(() => { window.location.href = 'login.html'; }, 1500);
});
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<div id="print-area" class="pdf-page" style="display:none;">

    <!-- BORDER FRAME -->
    <div class="pdf-frame">

        <!-- WATERMARK -->
        <div class="pdf-watermark">Breathe Green</div>

        <!-- HEADER -->
        <div class="pdf-header">
            <div>
                <h1 class="pdf-title">Breathe Green ‚Äì Smoking Cessation Report</h1>
                <p class="pdf-date">Generated on: <span id="pdfDate"></span></p>
            </div>
        </div>

        <hr class="pdf-divider">

        <!-- SUMMARY SECTION -->
        <h2 class="section-title">Official Summary</h2>
        <p class="summary-text">
            This official report outlines your smoking cessation progress based on tracked activity 
            within the Breathe Green system. Your financial savings, cigarette reduction, streak 
            duration, and estimated CO‚ÇÇ impact highlight your ongoing improvement and long-term 
            health benefits.
        </p>

        <!-- ANALYTICS GRID -->
      <table class="pro-stats-table">
          <thead>
              <tr>
                  <th>Category</th>
                  <th>Value</th>
                  <th>Description</th>
              </tr>
          </thead>

          <tbody>
              <tr>
                  <td>Money Saved</td>
                  <td id="moneySaved">‚Ç±1,540</td>
                  <td>Total amount saved from avoided cigarette purchases</td>
              </tr>

              <tr>
                  <td>Cigarettes Not Smoked</td>
                  <td id="cigsNotSmoked">84</td>
                  <td>Total sticks prevented</td>
              </tr>

              <tr>
                  <td>Days Streak</td>
                  <td id="daysStreak">12 days</td>
                  <td>Duration of your smoke-free streak</td>
              </tr>

              <tr>
                  <td>CO‚ÇÇ Prevented</td>
                  <td id="co2Prevented">2.4 kg</td>
                  <td>Estimated environmental reduction</td>
              </tr>
          </tbody>
      </table>

        <!-- CHARTS -->
<!-- Inside #print-area -->
        <div id="charts-container">
            <div class="report-card">
                <h2 class="section-title">Daily Progress</h2>
                <canvas id="progressChartPDF"></canvas>
            </div>
            <div class="report-card">
                <h2 class="section-title">Weekly Savings Breakdown</h2>
                <canvas id="savingsChartPDF"></canvas>
            </div>
        </div>


        <!-- INSIGHTS -->
        <div class="report-card">
            <h2 class="section-title">Insights</h2>
            <p class="summary-text">
                Your streak is steadily increasing. Consider setting higher weekly savings goals 
                or tracking additional health metrics. Regularly reviewing your daily progress 
                encourages consistency and long-term success.
            </p>
        </div>

        <hr class="pdf-divider">

        <!-- FOOTER -->
        <div class="pdf-footer">
            <p class="footer-text">Breathe Green ¬© 2025 ‚Ä¢ Smoking Cessation Report</p>
            <p class="page-number"></p>
        </div>

    </div>

</div>


<script>
document.getElementById("pdfDate").innerText =
    new Date().toLocaleDateString("en-US", {
        year: "numeric",
        month: "long",
        day: "numeric"
    });

// Auto page-numbering after PDF generation
function addPageNumbers(pdf) {
    const total = pdf.internal.getNumberOfPages();

    for (let i = 1; i <= total; i++) {
        pdf.setPage(i);
        pdf.setFontSize(10);
        pdf.text(`Page ${i} of ${total}`, 105, 290, { align: "center" });
    }
    return pdf;
}
    
const progressChartPDF = new Chart(document.getElementById('progressChartPDF'), {
    type: 'line',
    data: {
        labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
        datasets: [{
            label: 'Cigarettes Not Smoked',
            data: [4,6,7,9,12,15,20],
            borderWidth: 2,
            borderColor: '#000000',
            backgroundColor: 'rgba(0,0,0,0.1)',
            fill: true,
            tension: 0.3
        }]
    },
    options: {
        responsive: false,
        animation: false,
        plugins: { legend: { display: true, labels: { color: '#000000' } } },
        scales: {
            x: { ticks: { color: '#000000' } },
            y: { ticks: { color: '#000000' } }
        }
    }
});

const savingsChartPDF = new Chart(document.getElementById('savingsChartPDF'), {
    type: 'bar',
    data: {
        labels: ['Week 1','Week 2','Week 3','Week 4'],
        datasets: [{
            label: 'Money Saved (‚Ç±)',
            data: [520,380,460,680],
            borderWidth: 1,
            backgroundColor: '#000000'
        }]
    },
    options: {
        responsive: false,
        animation: false,
        plugins: { legend: { display: true, labels: { color: '#000000' } } },
        scales: {
            x: { ticks: { color: '#000000' } },
            y: { ticks: { color: '#000000' }, beginAtZero: true }
        }
    }
});


document.getElementById("print-pdf-btn").addEventListener("click", async () => {
    const area = document.getElementById("print-area");
    const includeCharts = document.getElementById("includeTables").checked; // <- fixed ID

    const chartsContainer = document.getElementById("charts-container");
    chartsContainer.style.display = includeCharts ? "block" : "none";

    area.style.display = "block";
    area.style.filter = "grayscale(100%)";

    // Give the browser a moment to render
    await new Promise(r => setTimeout(r, 100));

    const canvas = await html2canvas(area, { scale: 2, useCORS: true, backgroundColor: "#ffffff" });

    area.style.display = "none";
    chartsContainer.style.display = "block"; // restore

    const imgData = canvas.toDataURL("image/jpeg", 1.0);
    const pdf = new jspdf.jsPDF("p", "mm", "a4");

    const pageWidth = 210;
    const pageHeight = 297;
    const margin = 10;

    const imgProps = pdf.getImageProperties(imgData);
    const scaleX = (pageWidth - 2 * margin) / imgProps.width;
    const scaleY = (pageHeight - 2 * margin) / imgProps.height;
    const scale = Math.min(scaleX, scaleY);

    const pdfWidth = imgProps.width * scale;
    const pdfHeight = imgProps.height * scale;

    const x = (pageWidth - pdfWidth) / 2;
    const y = (pageHeight - pdfHeight) / 2;

    pdf.addImage(imgData, "JPEG", x, y, pdfWidth, pdfHeight);

    addPageNumbers(pdf);

    pdf.save("quit-smoking-analytics.pdf");
});


</script>

</body>

</html>



